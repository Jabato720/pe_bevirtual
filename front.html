<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Financiero Profesional: THE RESET IBIZA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #fafafa;
            --card-bg: #ffffff;
            --border-color: #eaeaea;
            --text-primary: #000000;
            --text-secondary: #666666;
            --accent-color: #0070f3;
            --input-bg: #ffffff;
            --btn-primary-bg: #000000;
            --btn-primary-text: #ffffff;
            --btn-secondary-bg: #ffffff;
            --btn-secondary-text: #666666;
            --btn-secondary-border: #eaeaea;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
        }
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -2px rgba(0,0,0,0.05);
        }
        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }
        .input-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        .input-group input {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 112, 243, 0.2);
        }
        .kpi-card {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
        }
        .kpi-card .value {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .kpi-card .label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 0.75rem 1rem;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }
        th {
            background-color: #fafafa;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: right;
        }
        td.month-col, th.text-left {
            font-weight: 600;
            text-align: left;
            color: var(--text-primary);
        }
        .positive { color: #16a34a; }
        .negative { color: #dc2626; }
        .total-field {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            padding-left: 1rem;
            background-color: transparent;
            border-bottom: 1px solid var(--border-color);
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: var(--btn-primary-bg);
            color: var(--btn-primary-text);
        }
        .btn-primary:hover {
            background-color: #333;
        }
        .btn-secondary {
            background-color: var(--btn-secondary-bg);
            color: var(--btn-secondary-text);
            border-color: var(--btn-secondary-border);
        }
        .btn-secondary:hover {
            border-color: #000;
            color: #000;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-12">
             <div class="grid grid-cols-3 items-center">
                <div class="w-1/3"></div>
                <div class="flex flex-col items-center text-center">
                    <svg id="Capa_2" data-name="Capa 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 914.28 256.16" class="h-12 w-auto">
                      <defs>
                        <style>
                          .cls-1 {
                            fill: #1e1f1d;
                          }
                        </style>
                      </defs>
                      <g id="Layer_1" data-name="Layer 1">
                        <g>
                          <g>
                            <path class="cls-1" d="M316.27,197l-35.63-91.31h14.86l29.54,75.74,29.54-75.74h13.97l-35.63,91.31h-16.65Z"/>
                            <path class="cls-1" d="M385.56,105.68h36.35v62.67c0,7.76,1.73,12.92,5.19,15.49,3.46,2.57,10.09,3.13,19.87,1.7v11.46c-5.49.84-10.24,1.31-14.23,1.43-4,.12-7.46-.42-10.38-1.61-2.92-1.19-5.31-2.6-7.16-4.21-1.85-1.61-3.31-3.82-4.39-6.62s-1.82-5.67-2.24-8.59c-.42-2.92-.63-6.36-.63-10.29v-49.42h-22.38v-12ZM407.94,67.55h13.97v20.23h-13.97v-20.23Z"/>
                            <path class="cls-1" d="M463.98,185h22.38v-46.91c0-12.65,4.48-21.9,13.43-27.75,8.95-5.85,20.89-7.58,35.81-5.19v12.53c-10.27-2.27-18.71-1.43-25.33,2.51-6.62,3.94-9.94,9.91-9.94,17.9v46.91h27.75v12h-64.1v-12Z"/>
                            <path class="cls-1" d="M591.64,164.77c0,9.55,1.82,15.76,5.46,18.62,3.64,2.87,11.19,3.58,22.65,2.15v11.46c-6.09.72-11.34,1.19-15.76,1.43-4.42.24-8.18-.33-11.28-1.7-3.1-1.37-5.64-2.89-7.61-4.57-1.97-1.67-3.49-4.09-4.57-7.25s-1.82-6.39-2.24-9.67c-.42-3.28-.63-7.19-.63-11.73v-45.84h-25.07v-12h67.14v12h-28.11v47.09Z"/>
                            <path class="cls-1" d="M661.82,105.68v59.62c0,7.04,2.12,12.38,6.36,16.03s10.06,5.46,17.46,5.46,13.22-1.82,17.46-5.46,6.36-8.98,6.36-16.03v-59.62h13.96v58.73c0,11.1-3.37,19.61-10.12,25.51-6.74,5.91-15.96,8.86-27.66,8.86s-20.74-2.95-27.48-8.86c-6.74-5.91-10.12-14.41-10.12-25.51v-58.73h13.79Z"/>
                            <path class="cls-1" d="M760.47,150.54c5.97-4.6,14.26-6.89,24.89-6.89,12.41,0,21.67,3.04,27.75,9.13v-17.55c0-6.45-1.94-11.37-5.82-14.77-3.88-3.4-9.22-5.1-16.03-5.1-7.16,0-12.5,1.4-16.02,4.21s-5.28,7.31-5.28,13.52h-13.96c0-19.46,11.76-29.18,35.27-29.18,11.1,0,19.81,2.71,26.14,8.15,6.33,5.43,9.49,13.46,9.49,24.08v32.23c0,7.64,1.13,12.77,3.4,15.4,2.27,2.63,6.51,3.22,12.71,1.79v11.46c-14.8,3.58-23.99-.06-27.57-10.92-5.73,8.48-15.82,12.71-30.26,12.71-10.5,0-18.74-2.3-24.71-6.89-5.97-4.59-8.95-11.49-8.95-20.68s2.98-16.08,8.95-20.68ZM788.76,186.79c7.4,0,13.31-1.4,17.73-4.21,4.42-2.81,6.62-6.77,6.62-11.91s-2.21-9.07-6.62-11.82c-4.42-2.75-10.33-4.12-17.73-4.12-15.52,0-23.28,5.31-23.28,15.93s7.76,16.11,23.28,16.11Z"/>
                            <path class="cls-1" d="M852.86,64.5h36.35v103.85c0,7.76,1.73,12.92,5.19,15.49,3.46,2.57,10.09,3.13,19.88,1.7v11.46c-5.49.84-10.24,1.31-14.23,1.43-4,.12-7.46-.42-10.38-1.61-2.92-1.19-5.31-2.6-7.16-4.21-1.85-1.61-3.31-3.82-4.39-6.62s-1.82-5.67-2.24-8.59c-.42-2.92-.63-6.36-.63-10.29v-90.6h-22.38v-12Z"/>
                          </g>
                          <g>
                            <path class="cls-1" d="M56.16,60.6v42.28c0,1.2,1.37,1.86,2.32,1.12,5.39-4.17,12.39-6.25,21.02-6.25,10.41,0,18.62,3.25,24.63,9.74,6,6.49,9.01,15.93,9.01,28.3v23.16c0,12.38-3.74,21.81-11.21,28.3-7.47,6.49-17.7,9.74-30.69,9.74s-23.03-3.25-30.51-9.74c-7.47-6.49-11.21-15.93-11.21-28.3V60.6c0-.8.65-1.44,1.44-1.44h23.76c.8,0,1.44.65,1.44,1.44ZM60.21,124.04c-2.7,2.2-4.04,5.51-4.04,9.93v26.83c0,8.82,5.02,13.23,15.07,13.23,4.78,0,8.52-1.1,11.21-3.31,2.7-2.2,4.04-5.51,4.04-9.92v-26.83c0-8.82-5.02-13.23-15.07-13.23-4.78,0-8.52,1.1-11.21,3.31Z"/>
                            <path class="cls-1" d="M203.85,165.99h18.9c2.15,0,3.9,1.75,3.9,3.9v18.9c0,2.15-1.75,3.9-3.9,3.9h-18.9c-2.15,0-3.9-1.75-3.9-3.9v-18.9c0-2.15,1.75-3.9,3.9-3.9Z"/>
                            <path class="cls-1" d="M171.39,174.03c-4.9,0-8.64-1.16-11.21-3.49-2.57-2.33-3.86-5.57-3.86-9.74v-3.73c0-.78.63-1.41,1.41-1.41h54.15c.78,0,1.41-.63,1.41-1.41v-18.43c0-12.38-3.74-21.81-11.21-28.3-7.47-6.49-17.64-9.74-30.51-9.74s-23.22,3.25-30.69,9.74c-7.47-6.49-11.21,15.93-11.21,28.3v23.16c0,12.38,3.77,21.81,11.3,28.3,7.53,6.49,17.67,9.74,30.42,9.74h15.28c.78,0,1.41-.63,1.41-1.41v-20.15c0-.78-.63-1.41-1.41-1.41h-15.28ZM156.32,133.96c0-4.41,1.35-7.72,4.04-9.93,2.7-2.2,6.43-3.31,11.21-3.31,10.05,0,15.07,4.41,15.07,13.23v2.39h-30.32v-2.39Z"/>
                          </g>
                          <path d="M217.92,256.16H38.24c-21.09,0-38.24-17.16-38.24-38.24V38.24C0,17.16,17.16,0,38.24,0h179.67c21.09,0,38.24,17.16,38.24,38.24v179.68c0,21.09-17.16,38.24-38.24,38.24ZM38.24,14c-13.37,0-24.24,10.88-24.24,24.24v179.68c0,13.37,10.88,24.24,24.24,24.24h179.67c13.37,0,24.24-10.88,24.24-24.24V38.24c0-13.37-10.88-24.24-24.24-24.24H38.24Z"/>
                        </g>
                      </g>
                    </svg>
                    <h1 class="text-2xl font-bold text-gray-800 mt-4">Plan de Viabilidad Econ√≥mica</h1>
                    <p class="text-lg text-gray-500">RESET FITNESS, IBIZA</p>
                </div>
                <div class="flex justify-end items-center">
                    <div class="text-right">
                        <div class="text-sm font-medium text-gray-800">usuario@email.com</div>
                        <a href="#" class="text-xs text-gray-500 hover:text-accent-color">Log Out</a>
                    </div>
                </div>
            </div>
        </header>

        <div class="card">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Supuestos Generales y de Ingresos</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6">
                <div class="input-group"><label for="inversion">Inversi√≥n Inicial (‚Ç¨)</label><input type="number" id="inversion" value="500000" class="main-input"></div>
                <div class="input-group"><label for="cuotaMensual">Cuota Mensual / Socio (‚Ç¨)</label><input type="number" id="cuotaMensual" value="70" class="main-input"></div>
                <div class="input-group"><label for="ingresoPT">Ingreso Neto Personal Training (‚Ç¨/mes)</label><input type="number" id="ingresoPT" value="0" class="main-input"></div>
                <div class="input-group"><label for="cuotaInscripcion">Cuota Inscripci√≥n / Nuevo Socio (‚Ç¨)</label><input type="number" id="cuotaInscripcion" value="0" class="main-input"></div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Supuestos de Costes y P√©rdidas</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6">
                 <div class="input-group"><label for="churnRate">Tasa de Bajas Mensual (%)</label><input type="number" id="churnRate" value="5" class="main-input"></div>
                <div class="input-group"><label for="costeVariable">Coste Variable / Socio (‚Ç¨)</label><input type="number" id="costeVariable" value="15" class="main-input"></div>
                <div class="input-group"><label for="costeLlave">Coste Llave / Nuevo Socio (‚Ç¨)</label><input type="number" id="costeLlave" value="0" class="main-input"></div>
                <div class="input-group"><label for="tasaMorosos">Tasa de Morosos (%)</label><input type="number" id="tasaMorosos" value="0" class="main-input"></div>
                 <div class="input-group"><label for="cac">Coste Adquisici√≥n Cliente (‚Ç¨)</label><input type="number" id="cac" value="50" class="main-input"></div>
            </div>
        </div>

        <div class="card">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Desglose de Costes Fijos Mensuales</h2>
                <button id="add-cost-btn" class="btn btn-primary text-sm">A√±adir Coste</button>
            </div>
            <div id="fixed-costs-container" class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
            </div>
            <div class="mt-4 pt-4 border-t border-gray-200 text-right">
                <span class="text-gray-500 font-medium">Total Costes Fijos Mensuales:</span>
                <span id="totalCostesFijos" class="total-field ml-2"></span>
            </div>
        </div>

        <div class="card">
             <h2 class="text-xl font-semibold text-gray-800 mb-4">Resumen de M√©tricas Clave</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="kpi-card"><div id="kpi-break-even" class="value">--</div><div class="label">Punto de Equilibrio</div></div>
                <div class="kpi-card"><div id="kpi-socios-y2" class="value">--</div><div class="label">Socios al Mes 24</div></div>
                <div class="kpi-card"><div id="kpi-ingresos-y1" class="value">--</div><div class="label">Ingresos (12 meses op.)</div></div>
                <div class="kpi-card"><div id="kpi-ebitda-y1" class="value">--</div><div class="label">% EBITDA (12 meses op.)</div></div>
                <div class="kpi-card"><div id="kpi-caja-y2" class="value">--</div><div class="label">Flujo de Caja Acum. (Mes 24)</div></div>
            </div>
        </div>

        <div class="card">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">Proyecci√≥n Financiera a 24 Meses</h2>
            <div class="table-container">
                <table id="projection-table"></table>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let fixedCosts = [
                { id: 'costeAlquiler', label: 'Alquiler del Local', value: 5000 },
                { id: 'costeLeasing', label: 'Leasing Material Fitness', value: 0 },
                { id: 'costePersonal', label: 'Salarios Inc. SS.SS', value: 13750 },
                { id: 'costeSuministros', label: 'Suministros (Luz, Agua, Net)', value: 2000 },
                { id: 'costeSeguros', label: 'Seguros (Insurance)', value: 300 },
                { id: 'costeGestoria', label: 'Gastos de Gestor√≠a', value: 0 },
                { id: 'costeMantenimiento', label: 'Mantenimiento', value: 500 },
                { id: 'costeLicencias', label: 'Licencias (SGAE, Les Mills, etc.)', value: 750 },
                { id: 'costeMarketing', label: 'Marketing Fijo y Branding', value: 1000 },
                { id: 'costeOtros', label: 'Otros Costes Operativos / Adm√≥n.', value: 1700 },
                { id: 'costePrestamo', label: 'Cuota Pr√©stamo Financiaci√≥n', value: 0 },
            ];

            const fixedCostsContainer = document.getElementById('fixed-costs-container');
            const addCostBtn = document.getElementById('add-cost-btn');

            const formatCurrency = (value) => new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(value);
            const getColorClass = (value) => value >= 0 ? 'positive' : 'negative';

            function renderFixedCosts() {
                fixedCostsContainer.innerHTML = '';
                fixedCosts.forEach((cost, index) => {
                    const div = document.createElement('div');
                    div.className = 'input-group flex items-end space-x-2';
                    div.innerHTML = `
                        <div class="flex-grow">
                            <label for="cost-label-${index}">Concepto</label>
                            <input type="text" id="cost-label-${index}" value="${cost.label}" class="cost-label-input">
                        </div>
                        <div class="flex-grow">
                             <label for="cost-value-${index}">Valor (‚Ç¨)</label>
                            <input type="number" id="cost-value-${index}" value="${cost.value}" class="cost-value-input main-input">
                        </div>
                        <button class="btn btn-secondary remove-cost-btn mb-1" data-index="${index}">X</button>
                    `;
                    fixedCostsContainer.appendChild(div);
                });
                
                document.querySelectorAll('.cost-label-input').forEach(input => input.addEventListener('input', handleCostLabelChange));
                document.querySelectorAll('.cost-value-input').forEach(input => input.addEventListener('input', updateFinancials));
                document.querySelectorAll('.remove-cost-btn').forEach(button => button.addEventListener('click', handleRemoveCost));
            }

            function handleCostLabelChange(e) {
                const index = e.target.id.split('-')[2];
                fixedCosts[index].label = e.target.value;
            }

            function handleRemoveCost(e) {
                e.preventDefault();
                const index = parseInt(e.target.dataset.index, 10);
                fixedCosts.splice(index, 1);
                renderFixedCosts();
                updateFinancials();
            }

            addCostBtn.addEventListener('click', () => {
                fixedCosts.push({ id: `custom-${Date.now()}`, label: 'Nuevo Coste', value: 0 });
                renderFixedCosts();
                updateFinancials();
            });

            const getNewMembersPlan = () => {
                const plan = Array(25).fill(0);
                plan[9] = 100; plan[10] = 400; plan[11] = 150; plan[12] = 150;
                for (let i = 13; i <= 24; i++) { plan[i] = 75; }
                return plan;
            };

            function updateFinancials() {
                document.querySelectorAll('.cost-value-input').forEach((input, index) => {
                    if(fixedCosts[index]) {
                        fixedCosts[index].value = parseFloat(input.value) || 0;
                    }
                });

                const cuotaMensual = parseFloat(document.getElementById('cuotaMensual').value) || 0;
                const ingresoPT = parseFloat(document.getElementById('ingresoPT').value) || 0;
                const cuotaInscripcion = parseFloat(document.getElementById('cuotaInscripcion').value) || 0;
                const churnRate = (parseFloat(document.getElementById('churnRate').value) || 0) / 100;
                const costeVariable = parseFloat(document.getElementById('costeVariable').value) || 0;
                const costeLlave = parseFloat(document.getElementById('costeLlave').value) || 0;
                const tasaMorosos = (parseFloat(document.getElementById('tasaMorosos').value) || 0) / 100;
                const cac = parseFloat(document.getElementById('cac').value) || 0;
                const inversion = parseFloat(document.getElementById('inversion').value) || 0;
                
                let totalCosteFijo = fixedCosts.reduce((sum, cost) => sum + cost.value, 0);
                document.getElementById('totalCostesFijos').textContent = formatCurrency(totalCosteFijo);

                const capitalTrabajo = 125000;
                const gastosPreOp = inversion - capitalTrabajo;

                const table = document.getElementById('projection-table');
                table.innerHTML = `
                    <thead>
                        <tr><th colspan="6" class="section-title text-left">Movimiento de Clientes</th></tr>
                        <tr><th class="text-left">Mes</th><th>Socios Inicio</th><th>Altas</th><th>Bajas</th><th>Socios Neto</th><th>Socios Final</th></tr>
                    </thead><tbody id="clients-body"></tbody>
                    <thead>
                        <tr><th colspan="17" class="section-title text-left">Cuenta de Resultados (P&L)</th></tr>
                        <tr id="pl-header-row"></tr>
                    </thead><tbody id="pl-body"></tbody>
                    <thead>
                        <tr><th colspan="17" class="section-title text-left">Flujo de Caja</th></tr>
                        <tr id="cf-header-row"></tr>
                    </thead><tbody id="cashflow-body"></tbody>
                `;

                let sociosTotales = 0;
                let flujoCajaAcumulado = capitalTrabajo;
                let breakEvenMonth = null;
                let ingresosY1 = 0;
                let ebitdaY1 = 0;
                let finalSocios = 0;
                const newMembersPlan = getNewMembersPlan();
                
                let results = { clients: [], pl: {}, cashflow: {} };
                const months = Array.from({length: 16}, (_, i) => i + 9);
                
                months.forEach(mes => {
                    const sociosInicio = sociosTotales;
                    const sociosNuevos = newMembersPlan[mes];
                    const sociosPerdidos = mes > 9 ? Math.round(sociosTotales * churnRate) : 0;
                    sociosTotales = sociosInicio - sociosPerdidos + sociosNuevos;
                    results.clients.push({mes, sociosInicio, sociosNuevos, sociosPerdidos, sociosNetos: sociosNuevos - sociosPerdidos, sociosTotales});

                    const ingresosCuotas = sociosTotales * cuotaMensual;
                    const ingresosInscripcion = sociosNuevos * cuotaInscripcion;
                    const totalIngresosBruto = ingresosCuotas + ingresoPT + ingresosInscripcion;
                    const perdidaMorosidad = totalIngresosBruto * tasaMorosos;
                    const totalIngresosNeto = totalIngresosBruto - perdidaMorosidad;
                    
                    const costeVariableTotal = sociosTotales * costeVariable;
                    const costeLlavesTotal = sociosNuevos * costeLlave;
                    const costeAdquisicion = sociosNuevos * cac;
                    const totalGastosVariables = costeVariableTotal + costeLlavesTotal + costeAdquisicion;
                    const totalGastos = totalGastosVariables + totalCosteFijo;

                    const ebitda = totalIngresosNeto - totalGastos;
                    
                    if (ebitda > 0 && breakEvenMonth === null) breakEvenMonth = mes;
                    if (mes >= 9 && mes <= 20) { ingresosY1 += totalIngresosNeto; ebitdaY1 += ebitda; }
                    if (mes === 24) finalSocios = sociosTotales;
                    
                    const plData = { totalIngresosNeto, perdidaMorosidad, totalGastos, ebitda };
                    for (const key in plData) {
                        if (!results.pl[key]) results.pl[key] = [];
                        results.pl[key].push(plData[key]);
                    }
                });
                
                const clientsBody = document.getElementById('clients-body');
                clientsBody.innerHTML = '';
                results.clients.forEach(c => {
                    clientsBody.innerHTML += `<tr><td class="month-col">Mes ${c.mes}</td><td>${c.sociosInicio}</td><td>${c.sociosNuevos}</td><td class="negative">(${c.sociosPerdidos})</td><td>${c.sociosNetos}</td><td>${c.sociosTotales}</td></tr>`;
                });

                const plHeaderRow = document.getElementById('pl-header-row');
                plHeaderRow.innerHTML = `<th class="text-left">Concepto</th>` + months.map(m => `<th>Mes ${m}</th>`).join('');
                
                const plBody = document.getElementById('pl-body');
                plBody.innerHTML = '';
                plBody.innerHTML += `<tr><td class="month-col">Ingresos Netos</td>${results.pl.totalIngresosNeto.map(v => `<td>${formatCurrency(v)}</td>`).join('')}</tr>`;
                plBody.innerHTML += `<tr><td class="month-col negative" style="padding-left: 2rem;">(P√©rdida Morosidad)</td>${results.pl.perdidaMorosidad.map(v => `<td class="negative">(${formatCurrency(v)})</td>`).join('')}</tr>`;
                plBody.innerHTML += `<tr><td class="month-col negative">Total Gastos</td>${results.pl.totalGastos.map(v => `<td class="negative">(${formatCurrency(v)})</td>`).join('')}</tr>`;
                plBody.innerHTML += `<tr class="font-bold" style="background-color: rgba(22, 163, 74, 0.1);"><td class="month-col">EBITDA</td>${results.pl.ebitda.map(v => `<td class="${getColorClass(v)}">${formatCurrency(v)}</td>`).join('')}</tr>`;
                
                const cfHeaderRow = document.getElementById('cf-header-row');
                cfHeaderRow.innerHTML = `<th class="text-left">Concepto</th><th>Mes 1-8</th>` + months.map(m => `<th>Mes ${m}</th>`).join('');

                const cashflowBody = document.getElementById('cashflow-body');
                cashflowBody.innerHTML = '';
                let cashflowNetoRow = `<td>${formatCurrency(capitalTrabajo)}</td>`;
                let cashflowAcumRow = `<td>${formatCurrency(capitalTrabajo)}</td>`;
                let currentCashflow = capitalTrabajo;

                results.pl.ebitda.forEach(ebitda => {
                    cashflowNetoRow += `<td class="${getColorClass(ebitda)}">${formatCurrency(ebitda)}</td>`;
                    currentCashflow += ebitda;
                    cashflowAcumRow += `<td class="${getColorClass(currentCashflow)}">${formatCurrency(currentCashflow)}</td>`;
                });
                
                cashflowBody.innerHTML += `<tr><td class="month-col">Flujo de Caja Neto</td>${cashflowNetoRow}</tr>`;
                cashflowBody.innerHTML += `<tr class="font-bold" style="background-color: #f9fafb;"><td class="month-col">Flujo de Caja Acumulado</td>${cashflowAcumRow}</tr>`;
                
                document.getElementById('kpi-break-even').textContent = breakEvenMonth ? `Mes ${breakEvenMonth}` : 'Nunca';
                document.getElementById('kpi-socios-y2').textContent = finalSocios;
                document.getElementById('kpi-ingresos-y1').textContent = formatCurrency(ingresosY1 / 1000) + 'k';
                document.getElementById('kpi-ebitda-y1').textContent = ingresosY1 > 0 ? `${((ebitdaY1/ingresosY1)*100).toFixed(1)}%` : 'N/A';
                document.getElementById('kpi-caja-y2').textContent = formatCurrency(currentCashflow / 1000) + 'k';
            }

            document.querySelectorAll('.main-input').forEach(input => input.addEventListener('input', updateFinancials));
            renderFixedCosts();
            updateFinancials();
        });
    </script>
</body>
</html>
